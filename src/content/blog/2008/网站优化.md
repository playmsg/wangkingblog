---
title: "网站优化"
description: "很惭愧，一天10000IP而已，服务器CPU就100%了"
pubDate: "Oct 31 2008"
heroImage: "/blog-placeholder.jpg"
---
很惭愧，一天10000IP而已，服务器CPU就100%了。不知道是不是有人在批量抓取网站，这几天服务器特别的慢。通过观测CPU，CF和SQLSERVER各占了50%。于是开始进行SQL方面的优化。

但是查看代码，发现存在CFQUERY在使用cfqueryparam的情况下不能进行CACHE的问题，而且要改的话，工作量异常的大，所以另想办法。最后通过把页面内容全部缓冲在application中的方法搞了一下，表面上看起来速度上升了几十倍，但是还没有经过长时间运营测试，结果不好说的很。另外，需要改动的页面也不少，只改动了最常访问的页面。CPU降低到70-80左右，相信如果都改过的话，可以降低到20左右。但是稳定性尚不得可知。

基本思路是SQL如果满负荷工作，需要占用1.5G内存，不如把内容缓冲到内存里，也就是几百兆足够了。

最近做的[丝袜脚](http://www.51bobo.com "丝袜脚")网站很有趣，IP一天800，PV一天15000，看来群众果然有审美需求啊。这个网站完全采用静态文件构建，采用nginx做webserver，相信应该很能挺。

如果页面内存缓冲好用的话，今后搭建大型网站时，应该早做部署。
